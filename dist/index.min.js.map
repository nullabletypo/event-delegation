{"version":3,"file":"index.min.js","sources":["../src/event-delegation.ts"],"sourcesContent":["export const closest = (root: Element, el: Element, sel: string) => {\n  // include root node\n  const parent = root.parentElement\n  do {\n    if (el.matches(sel)) return el\n    el = el.parentElement!\n  } while (el != null && el !== parent)\n  return null\n}\n\n// Disguise event.target as matched element\nexport const proxy = (ev: Event, target: any): Event => {\n  const get = (event: any, prop: string) => (prop === 'target' ? target : Reflect.get(event, prop))\n  return new Proxy(ev, { get })\n}\n\nexport const listener = (root: Element, sel: string | undefined, handler: Function) => {\n  if (sel === undefined) {\n    return (e: Event) => handler.call(root, proxy(e, root))\n  }\n  return (e: Event) => {\n    const target = e.target as Element\n    const matched = closest(root, target, sel)\n    if (matched != null) {\n      handler.call(matched, proxy(e, matched))\n    }\n  }\n}\n\ntype EventType = keyof HTMLElementEventMap\n\nexport interface EventDelegatorOptions extends AddEventListenerOptions {}\n\ntype Opts = EventDelegatorOptions\n\nexport type EventHandler<T extends Event = Event> = (ev: T) => void\n\nexport class EventDelegator {\n  target: EventTarget\n  options?: Opts = {}\n  // [origin handler, wrapped handler]\n  _listenerMap = new WeakMap<EventHandler<any>, EventHandler<any>>()\n\n  constructor(target: EventTarget, options: Opts = {}) {\n    this.target = target\n    this.options = options\n  }\n  /* eslint-disable no-dupe-class-members */\n  on<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: string, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: EventType, sel: string | undefined, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: string, sel: string | undefined, handler: EventHandler<T>, options?: Opts): () => void\n  on(type: string, a: any, b: any, c?: Opts) {\n    const [sel, handler, options] =\n      typeof a === 'string' ? [a, b, c] : typeof a === 'undefined' ? [undefined, b, c] : [undefined, a, b]\n    const opts: Opts = { ...this.options, ...options }\n    const _listener = listener(this.target as Element, sel, handler)\n    this._listenerMap.set(handler, _listener)\n    this.target.addEventListener(type, _listener, opts)\n    return () => this.target.removeEventListener(type, _listener, opts)\n  }\n\n  off<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts): void\n  off<T extends Event>(type: string, handler: EventHandler<T>, options?: Opts): void\n  off<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts) {\n    options = { ...this.options, ...options }\n    const _listener = this._listenerMap.get(handler)\n    if (_listener != null) {\n      this.target.removeEventListener(type, _listener, options)\n    }\n  }\n\n  static assignEventTarget = proxy\n}\n\nexport const delegate = (target: EventTarget, defaultOptions?: Opts) => {\n  return new EventDelegator(target, defaultOptions)\n}\n\n/**\n * Shorthand of CustomEvent\n */\nexport const fire = (target: EventTarget, type: string, detail?: any) => {\n  const event = new CustomEvent(type, { bubbles: true, composed: true, cancelable: true, detail })\n  return target.dispatchEvent(event)\n}\n"],"names":["const","proxy","ev","target","Proxy","event","prop","Reflect","get","EventDelegator","constructor","options","WeakMap","on","type","a","b","c","undefined","opts","Object","this","_listener","root","sel","handler","e","call","matched","el","parent","parentElement","matches","closest","listener","_listenerMap","set","addEventListener","removeEventListener","off","defaultOptions","detail","CustomEvent","bubbles","composed","cancelable","dispatchEvent"],"mappings":"AAAOA,IAWMC,WAASC,EAAWC,UAExB,IAAIC,MAAMF,EAAI,cADRG,EAAYC,SAA2B,WAATA,EAAoBH,EAASI,QAAQC,IAAIH,EAAOC,OAyBhFG,EAMXC,SAAYP,EAAqBQ,kBAAgB,iBAJhC,qBAEF,IAAIC,aAGZT,OAASA,OACTQ,QAAUA,GAOjBE,YAAAA,YAAGC,EAAcC,EAAQC,EAAQC,gBAEhB,iBAANF,EAAiB,CAACA,EAAGC,EAAGC,QAAkB,IAANF,EAAoB,MAACG,EAAWF,EAAGC,GAAK,MAACC,EAAWH,EAAGC,iBAC9FG,EAAaC,iBAAKC,KAAKV,cACvBW,WAxCeC,EAAeC,EAAyBC,eACnDP,IAARM,WACME,UAAaD,EAAQE,KAAKJ,EAAMtB,EAAMyB,EAAGH,cAE3CG,OAEAE,WAtBcL,EAAeM,EAAaL,OAE5CM,EAASP,EAAKQ,gBACjB,IACGF,EAAGG,QAAQR,GAAM,OAAOK,EAC5BA,EAAKA,EAAGE,oBACK,MAANF,GAAcA,IAAOC,UACvB,KAeWG,CAAQV,EADTG,EAAEvB,OACqBqB,GACvB,MAAXI,GACFH,EAAQE,KAAKC,EAAS3B,EAAMyB,EAAGE,KAgCfM,CAASb,KAAKlB,OAAmBqB,EAAKC,eACnDU,aAAaC,IAAIX,EAASH,QAC1BnB,OAAOkC,iBAAiBvB,EAAMQ,EAAWH,qBACjCE,EAAKlB,OAAOmC,oBAAoBxB,EAAMQ,EAAWH,KAKhEoB,YAAAA,aAAqBzB,EAAiBW,EAA0Bd,GAC9DA,EAAUS,iBAAKC,KAAKV,eACdW,EAAYD,KAAKc,aAAa3B,IAAIiB,GACvB,MAAbH,QACGnB,OAAOmC,oBAAoBxB,EAAMQ,EAAWX,IAI9CF,oBAAoBR,4BAGJE,EAAqBqC,UACrC,IAAI/B,EAAeN,EAAQqC,0BAMfrC,EAAqBW,EAAc2B,OAChDpC,EAAQ,IAAIqC,YAAY5B,EAAM,CAAE6B,SAAS,EAAMC,UAAU,EAAMC,YAAY,SAAMJ,WAChFtC,EAAO2C,cAAczC"}