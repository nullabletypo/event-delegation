{"version":3,"file":"index.mjs","sources":["../src/event-delegation.ts"],"sourcesContent":["export const closest = (root: Element, el: Element, sel: string) => {\n  // include root node\n  const parent = root.parentElement\n  do {\n    if (el.matches(sel)) return el\n    el = el.parentElement!\n  } while (el != null && el !== parent)\n  return null\n}\n\n// Disguise event.target as matched element\nexport const proxy = (ev: Event, target: any): Event => {\n  const get = (event: any, prop: string) => (prop === 'target' ? target : Reflect.get(event, prop))\n  return new Proxy(ev, { get })\n}\n\nexport const listener = (root: Element, sel: string | undefined, handler: Function) => {\n  if (sel === undefined) {\n    return (e: Event) => handler.call(root, proxy(e, root))\n  }\n  return (e: Event) => {\n    const target = e.target as Element\n    const matched = closest(root, target, sel)\n    if (matched != null) {\n      handler.call(matched, proxy(e, matched))\n    }\n  }\n}\n\ntype EventType = keyof HTMLElementEventMap\n\nexport interface EventDelegatorOptions extends AddEventListenerOptions {}\n\ntype Opts = EventDelegatorOptions\n\nexport type EventHandler<T extends Event = Event> = (ev: T) => void\n\nexport class EventDelegator {\n  target: EventTarget\n  options?: Opts = {}\n  // [origin handler, wrapped handler]\n  _listenerMap = new WeakMap<EventHandler<any>, EventHandler<any>>()\n\n  constructor(target: EventTarget, options: Opts = {}) {\n    this.target = target\n    this.options = options\n  }\n  /* eslint-disable no-dupe-class-members */\n  on<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: string, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: EventType, sel: string | undefined, handler: EventHandler<T>, options?: Opts): () => void\n  on<T extends Event>(type: string, sel: string | undefined, handler: EventHandler<T>, options?: Opts): () => void\n  on(type: string, a: any, b: any, c?: Opts) {\n    const [sel, handler, options] =\n      typeof a === 'string' ? [a, b, c] : typeof a === 'undefined' ? [undefined, b, c] : [undefined, a, b]\n    const opts: Opts = { ...this.options, ...options }\n    const _listener = listener(this.target as Element, sel, handler)\n    this._listenerMap.set(handler, _listener)\n    this.target.addEventListener(type, _listener, opts)\n    return () => this.target.removeEventListener(type, _listener, opts)\n  }\n\n  off<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts): void\n  off<T extends Event>(type: string, handler: EventHandler<T>, options?: Opts): void\n  off<T extends Event>(type: EventType, handler: EventHandler<T>, options?: Opts) {\n    options = { ...this.options, ...options }\n    const _listener = this._listenerMap.get(handler)\n    if (_listener != null) {\n      this.target.removeEventListener(type, _listener, options)\n    }\n  }\n\n  static assignEventTarget = proxy\n}\n\nexport const delegate = (target: EventTarget, defaultOptions?: Opts) => {\n  return new EventDelegator(target, defaultOptions)\n}\n\n/**\n * Shorthand of CustomEvent\n */\nexport const fire = (target: EventTarget, type: string, detail?: any) => {\n  const event = new CustomEvent(type, { bubbles: true, composed: true, cancelable: true, detail })\n  return target.dispatchEvent(event)\n}\n"],"names":["const","closest","root","el","sel","parent","parentElement","matches","proxy","ev","target","get","event","prop","Reflect","Proxy","listener","handler","undefined","e","call","matched","EventDelegator","constructor","options","WeakMap","on","type","a","b","c","opts","_listener","_listenerMap","set","addEventListener","this","removeEventListener","off","delegate","defaultOptions","fire","detail","CustomEvent","bubbles","composed","cancelable","dispatchEvent"],"mappings":"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"}